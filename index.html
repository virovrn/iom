<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ИОМ через Google Sheets</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop/1.5.4/tabletop.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    input, button { padding: 10px; font-size: 16px; margin-right: 10px; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eef; }
    .section { margin-top: 30px; }
  </style>
</head>
<body>
  <h1>Индивидуальный образовательный маршрут</h1>
  <div>
    <input type="text" id="userId" placeholder="Введите ID" />
    <button onclick="run()">Показать</button>
  </div>
  <div id="output"></div>

  <script>
    // Вставьте свой ID Google-таблицы
    const SPREADSHEET_KEY = '1Xaa2DP-ME57SHfuPzBfnTa2QyTHpGf9DGcHVmsFx4GE';

    function run() {
      const id = document.getElementById('userId').value.trim();
      if (!id) return alert('ID не введён');
      document.getElementById('output').innerHTML = 'Загрузка...';
      Tabletop.init({
        key: SPREADSHEET_KEY,
        callback: data => render(data, id),
        simpleSheet: false
      });
    }

    function render(data, userId) {
      const sheets = ['Info','Recom','Tut','Met','Feedback','Active'];
      const info = data.Info.elements.find(r => r.ID == userId);
      if (!info) {
        document.getElementById('output').innerHTML = `<p>ID ${userId} не найден.</p>`;
        return;
      }
      const fio = info['ФИО'] || info['FIO'];
      let html = `<h2>${fio}</h2>`;

      sheets.slice(1).forEach(sheet => {
        const rows = data[sheet].elements.filter(r => (r['ФИО']||r['FIO']) == fio);
        html += `<div class="section"><h3>${sheet}</h3>`;
        if (rows.length) {
          html += '<table><thead><tr>' +
                  Object.keys(rows[0])
                        .slice(1, sheet==='Recom'?6: sheet==='Active'?5:7)
                        .map(h=>`<th>${h}</th>`).join('') +
                  '</tr></thead><tbody>' +
                  rows.map(r=>'<tr>'+ Object.values(r)
                          .slice(1, sheet==='Recom'?6: sheet==='Active'?5:7)
                          .map(v=>`<td>${v}</td>`).join('') +
                  '</tr>').join('') +
                  '</tbody></table>';
        } else html += '<p>Нет данных</p>';
        html += '</div>';
      });

      document.getElementById('output').innerHTML = html;
    }
  </script>
</body>
</html>
